# Семинар 3. Персонализированные рекомендации

На этом семинаре мы применим библиотеку LightFM для построения персонализированного рекомендера треков. 

### План действий

0. Добавим библиотеку LightFM для использования в jupyter notebook
   1. Установим нужные библиотеки в виртуальном окружении (в файл с зависимостями были добавлены lightfm и ipykernel):
      ```
      pip install -r requirements.txt
      ``` 
   3. Создадим новый `kernel`:
      ```
      python -m ipykernel install --user --name=<your_env_name>
      ```
   4. Проверим, что он появился в списке доступных:
      ```
      jupyter kernelspec list
      ```
   5. В jupyter notebook сменим `kernel` на вновь созданный.

1. Используем ноутбук `Week3Seminar.ipynb`, для того, чтобы собрать данные для обучения рекомендера
    1. Выгружаем только позитивные интеракции user-track со временем прослушивания больше 0.8
    2. Загружаем сохраненные в предыдущем пункте данные в `Dataset` LightFM
    3. Перебираем гиперпараметры модели с помощью пакета `optuna`
    4. Обучаем модель с лучшими гиперпараметрами
    5. Смотрим на полученные эмбеддинги в tensorboard
    6. Выгружаем top-100 рекомендованных треков для пользователей

2. Реализуем новый рекомендер `Collaborative`, который будет выдавать персонализированные рекомендации
    1. Загружаем рекомендации в новую базу `Redis`
    2. При запросе идем в базу рекомендаций и достаем рекомендации по пользователю
    3. Если рекомендаций не нашлось, то возвращаем случайные
    
3. Создаем A/B эксперимент.
    1. В `botify.experiment.Experiments` создаем эксперимент `COLLABORATIVE`.
    2. В `botify.server.NextTrack` используем этот эксперимент для выбора рекомендера между `Random` и `Collaborative`.
    3. Запускаем рекомендер и симулятор.
    4. Скачиваем логи сервиса.
   
4. Используем ноутбук `Week1Seminar.ipynb` для анализа.
    1. Запускаем анализатор для эксперимента `COLLABORATIVE`.

#### TimeSVD

Допустим, качество айтемов эволюционирует по времени. Модель timeSVD учитывает это в bias b_i(t). Предложите примеры обучаемых функций b_i(t), которые могли бы выучить эту эволюцию.